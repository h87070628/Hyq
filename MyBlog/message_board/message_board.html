<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>CSS Dock Menu</title>
<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" src="../js/interface.js"></script>
<link href="../style.css" rel="stylesheet" type="text/css" />

<script type="text/javascript">
//定义一些全局变量.
</script>

<script type="text/javascript">
	function get_message()
	{
		<!--获得留言数据.-->
		//alert("获得留言数据.");

		//创建json对象.
		var xmlhttp;
		if(window.XMLHttpRequest){
			xmlhttp = new XMLHttpRequest();
		}else{
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		
		//构造json对象的参数,并发送json数据.
		xmlhttp.open("POST","../php/get_message.php",true);
		xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
		var param = "index_begin="+"0";
		xmlhttp.send(param);

		//回调函数,接收json对象的返回.
		xmlhttp.onreadystatechange=function()
		{
			if(xmlhttp.readyState==4 && xmlhttp.status==200){
				var json_obj = eval("("+xmlhttp.responseText+")");	//将从php传送过来的json对象转换成javascript对象.

				if(json_obj[0].a1 == undefined)	//后台成功返回,留言成功..
				{
					alert("很抱歉,留言加载失败.");
				}
				else
				{
					//alert("恭喜你,留言加载成功.");
					//document.getElementById("message_board_str").value = "";
					window.document.getElementById("p_reply").innerHTML = json_obj[0].a2 + "&nbsp&nbsp&nbsp&nbsp" + json_obj[0].a4 + "</br>" + json_obj[0].a3 + "<hr width=100% height=1>";
					for(i = 1; i < 10; i++)
					{
						if(json_obj[i].a1 != undefined)
						{
							var para = document.createElement("p");
							para.innerHTML = json_obj[i].a2 + "&nbsp&nbsp&nbsp&nbsp" + json_obj[i].a4 + "</br>" + json_obj[i].a3 + "<hr width=100% height=1>";
							var last_node = document.getElementById("p_reply").appendChild(para);
						}else{
							break;
						}
					}

				}
			}
		}
	};

	<!--页面初始化时,执行的脚本.-->
	$(document).ready(
				function()
				{
				<!--导航条的初始化.-->
				$('#dock').Fisheye(
					{
						maxWidth: 50,
						items: 'a',
						itemsText: 'span',
						container: '.dock-container',
						itemWidth: 40,
						proximity: 40,
						halign : 'center'
					});
				<!--初始化留言板.-->
				//	
				get_message();
				//
				}
			);

	function submit()
	{
		<!--单击提交按钮,上传文字到后台服务器.-->
		var message_submit = document.getElementById("message_board_str");

		//错误验证.
		if(message_submit.value.length<=0)
		{
			alert("不能提交空内容.");
			return false;
		}
		
		
		//创建json对象.
		var xmlhttp;
		if(window.XMLHttpRequest){
				xmlhttp = new XMLHttpRequest();
			}
			else{
				xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
		xmlhttp.open("POST","../php/message_board.php",true);
		xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
		var param = "userName="+"Null"+"&message_str="+ message_submit.value;
		xmlhttp.send(param);

		xmlhttp.onreadystatechange=function()
		{
			if(xmlhttp.readyState==4 && xmlhttp.status==200){
				var json_obj = eval("("+xmlhttp.responseText+")");	//将从php传送过来的json对象转换成javascript对象.

				if(json_obj.t_date == undefined)	//后台成功返回,留言成功..
				{
					alert("很抱歉,留言失败.");
				}
				else
				{
					//alert("恭喜你,留言成功.");
					document.getElementById("message_board_str").value = "";
					get_message();	//刷新留言列表.
				}

				/*
				if(json_obj.r1 == undefined)	
				{
					alert("很抱歉,留言失败.");
				}
				else
				{
					//alert("恭喜你,留言成功.");
					alert(json_obj.r1+json_obj.r2+json_obj.r3+json_obj.r4);
					document.getElementById("message_board_str").value = json_obj.r3 + "][" + json_obj.r3;
				}
				*/

			}
		}
	};
</script>
</head>

<body>
<div class="dock" id="dock">
	<div class="dock-container">
		<a class="dock-item" href="../index.html" onclick="x++;if(x>9){x=1;}document.getElementById('im_0').src='./apple/'+x.toString()+'.png'; return false;"><img src="../images/home.png" alt="home" /><span>Home</span></a> 

		<a class="dock-item" href="#"><img src="../images/email.png" alt="contact" /><span>Contact</span></a> 
		<a class="dock-item" href="#"><img src="../images/portfolio.png" alt="portfolio" /><span>Portfolio</span></a> 
		<a class="dock-item" href="#"><img src="../images/music.png" alt="music" /><span>Music</span></a> 
		<a class="dock-item" href="#"><img src="../images/video.png" alt="video" /><span>Video</span></a> 
		<a class="dock-item" href="#"><img src="../images/history.png" alt="history" /><span>History</span></a> 
		<a class="dock-item" href="#"><img src="../images/calendar.png" alt="calendar" /><span>Calendar</span></a> 
		<a class="dock-item" href="#"><img src="../images/link.png" alt="rss" /><span>RSS</span></a>
		<a class="dock-item" href="#"><img src="../images/rss.png" alt="rss" /><span>RSS</span></a> 
		<a class="dock-item" href="#"><img src="../images/rss2.png" alt="rss" /><span>RSS2</span></a>
	</div> 
</div>

<div id="blog_body">
	<p id="p_reply"></p>

	<script type="text/javascript">
		/*
		var message_board = new Array();
		
		message_board[0] = new Object();
		message_board[0].user = "anna";
		message_board[0].time = "2013-06-02 17:00";
		message_board[0].message = "来自江西,艾拉."
		
		message_board[1] = new Object();
		message_board[1].user = "Jerry";
		message_board[1].time = "2013-06-02 17:03";
		message_board[1].message = "Think you!!!";
		
		window.document.getElementById("p_reply").innerHTML = message_board[0].user + "&nbsp&nbsp&nbsp&nbsp" + message_board[0].time + "</br>" + message_board[0].message + "<hr width=100% height=1>";

		var para = document.createElement("p");
		para.innerHTML = message_board[1].user + "&nbsp&nbsp&nbsp&nbsp" + message_board[1].time + "</br>" + message_board[1].message;
		var last_node = document.getElementById("p_reply").appendChild(para);
		*/

	</script>
	<hr width=100% height=1>
	<button onclick="submit()">提交</button>
</div>
	<p style="text-align: center; margin: -50px auto;">
		<textarea id="message_board_str" style="resize: none; width:793px; height:100px;margin:0px auto;" rows="10" cols="30"></textarea>
	</p>
</body>

</html>
